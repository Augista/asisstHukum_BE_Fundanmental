datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  OWNER
  ADMIN
  LAWYER
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  name      String
  role      Role      @default(OWNER)

  lawyer    Lawyer?

  businesses Business[] @relation("OwnerBusinesses")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Lawyer {
  idLawyer Int    @id @default(autoincrement())
  userId   Int    @unique
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  businesses    Business[]     @relation("LawyerBusinesses")
  consultations Consultation[] @relation("ConsultationLawyer")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Business {
  id      Int    @id @default(autoincrement())
  name    String

  ownerId Int?
  owner   User? @relation("OwnerBusinesses", fields: [ownerId], references: [id], onDelete: SetNull)

  lawyerId Int?
  lawyer   Lawyer? @relation("LawyerBusinesses", fields: [lawyerId], references: [idLawyer], onDelete: SetNull)

  nib           String?        @unique
  permits       Permit[]
  files         FileBusiness[]
  consultations Consultation[]
  resultFiles   FileResult[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Consultation {
  id         Int      @id @default(autoincrement())
  businessId Int
  business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  lawyerId Int?
  lawyer   Lawyer? @relation("ConsultationLawyer", fields: [lawyerId], references: [idLawyer], onDelete: SetNull)

  status ConsultationStatus @default(PENDING)
  notes  String?

  // kembali ke skema lama â†’ FileResult.consultationId
  resultFile FileResult? @relation("ConsultationResultFile")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FileResult {
  id             Int           @id @default(autoincrement())
  businessId     Int
  business       Business      @relation(fields: [businessId], references: [id], onDelete: Cascade)

  consultationId Int?          @unique
 consultation Consultation? @relation("ConsultationResultFile", fields: [consultationId], references: [id])

  filename       String
  url            String
  createdAt      DateTime      @default(now())
}

model Permit {
  id         Int      @id @default(autoincrement())
  businessId Int
  business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  filename   String
  url        String
  createdAt  DateTime @default(now())
}

model FileBusiness {
  id         Int      @id @default(autoincrement())
  businessId Int
  business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  filename   String
  url        String
  createdAt  DateTime @default(now())
}

enum ConsultationStatus {
  PENDING
  APPROVED
  REJECTED
}
